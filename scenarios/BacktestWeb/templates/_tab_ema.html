<div class="d-flex align-items-center gap-2 mb-3">
    <h2 class="mb-0">Par√°metros de Medias M√≥viles Exponenciales (EMA)</h2>
    <button type="button" class="btn btn-outline-info btn-sm" data-bs-toggle="modal" data-bs-target="#emaInfoModal">
        <i class="bi bi-info-circle"></i> ‚ÑπÔ∏è Ayuda
    </button>
</div>

<!-- Modal con informaci√≥n EMA -->
<div class="modal fade" id="emaInfoModal" tabindex="-1" aria-labelledby="emaInfoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title" id="emaInfoModalLabel">üìä Media M√≥vil Exponencial (EMA) - Gu√≠a Completa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p><strong>¬øQu√© es la EMA?</strong> La Media M√≥vil Exponencial es un indicador de tendencia que sigue los cambios de precio recientes. Usa dos per√≠odos: r√°pida (sensible) y lenta (suave).</p>
                
                <h6 class="mt-4 text-dark"><strong>Par√°metros Configurables:</strong></h6>
                <ul class="mb-3">
                    <li><strong>Per√≠odo EMA R√°pida:</strong> Por defecto 5. Detecta cambios r√°pidos (utilizado en cruces).</li>
                    <li><strong>Per√≠odo EMA Lenta:</strong> Por defecto 30. Define la tendencia general (utilizado en filtros de estado).</li>
                </ul>
                
                <h6 class="text-dark"><strong>Se√±ales Disponibles (Activables independientemente):</strong></h6>
                
                <div class="ps-3 border-start border-warning">
                    <p class="mb-2"><strong class="text-success">üü¢ COMPRA - L√≥gica OR (cualquiera activa la compra):</strong></p>
                    <ul class="small mb-3">
                        <li><strong>Cruce Ascendente:</strong> EMA R√°pida cruza por encima de EMA Lenta ‚Üí Cambio de tendencia al alza.</li>
                        <li><strong>M√≠nimo:</strong> EMA Lenta detecta un m√≠nimo local ‚Üí Rebote despu√©s de ca√≠da (reversal).</li>
                        <li><strong>Ascendente:</strong> EMA Lenta est√° subiendo confirmado ‚Üí Tendencia alcista continua.</li>
                    </ul>
                    
                    <p class="mb-2"><strong class="text-danger">üî¥ VENTA / BLOQUEO - L√≥gica AND:</strong></p>
                    <ul class="small mb-3">
                        <li><strong>Cruce Descendente:</strong> EMA R√°pida cruza por debajo de EMA Lenta ‚Üí Cambio de tendencia a la baja.</li>
                        <li>
                            <strong>M√°ximo Local + Descendente (Casi Lo Mismo):</strong><br>
                            <span class="text-danger">‚ö†Ô∏è Nota importante:</span> Cuando la EMA Lenta toca un pico (m√°ximo), por definici√≥n la siguiente vela estar√° m√°s baja, lo que ya constituye "descendente". Ambos casi siempre ocurren juntos.<br>
                            <span class="text-danger">‚Ü≥ VENTA:</span> Cierra posiciones abiertas en ambos casos<br>
                            <span class="text-danger">‚Ü≥ BLOQUEO:</span> Evita nuevas compras mientras est√© bajando despu√©s del pico.
                        </li>
                    </ul>
                </div>
                
                <div class="alert alert-warning alert-sm mt-3 mb-3">
                    <strong>üí° Reflexi√≥n sobre redundancia:</strong><br>
                    <small>T√©cnicamente, "M√°ximo" y "Descendente" son casi id√©nticos a nivel de bloqueo de compras, ya que un m√°ximo detectado implica que ya estamos bajando. Si encuentras que ambos se activan juntos en tus backtests, considera usar solo uno para simplificar tu estrategia.</small>
                </div>
                
                <div class="alert alert-danger alert-sm mb-3">
                    <strong>‚ö†Ô∏è PROTECCI√ìN HARDCODED (Veto Permanente):</strong><br>
                    <small>
                        <strong>IMPORTANTE:</strong> La EMA Lenta tiene un <strong>veto de seguridad hardcoded</strong> que SIEMPRE est√° activo:<br>
                        ‚Ä¢ Si <code>ema_slow_descendente_STATE = True</code> (EMA est√° bajando) ‚Üí <strong>BLOQUEA TODAS LAS COMPRAS</strong><br>
                        ‚Ä¢ Este bloqueo ocurre <strong>independientemente</strong> de si activaste o no el switch "Descendente"<br>
                        ‚Ä¢ Es una protecci√≥n permanente del c√≥digo para evitar compras en tendencias bajistas<br>
                        ‚Ä¢ <strong>Diferencia con RSI:</strong> RSI NO tiene vetos hardcoded, solo respeta los switches que actives
                    </small>
                </div>
                
                <hr class="my-3">
                
                <div class="alert alert-info alert-sm mb-3">
                    <strong>üí° Comportamiento SIN Switches Activados:</strong><br>
                    <small>
                        Si NO activas ning√∫n switch de EMA (Cruce, M√≠nimo, Ascendente, M√°ximo, Descendente):<br>
                        ‚Ä¢ <strong>Modo:</strong> Sistema entra en <strong>Buy & Hold</strong><br>
                        ‚Ä¢ <strong>COMPRA:</strong> ‚úÖ En m√≠nimos autom√°ticos (<code>ema_slow_minimo_STATE</code> o <code>ema_slow_ascendente_STATE</code>)<br>
                        ‚Ä¢ <strong>VENTA:</strong> ‚ùå Solo por Stop Loss (sin ventas t√©cnicas)<br>
                        ‚Ä¢ <strong>VETO HARDCODED:</strong> ‚ö†Ô∏è Sigue activo ‚Üí NO comprar√° si EMA Lenta est√° descendiendo<br>
                        <strong>Resultado:</strong> Estrategia pasiva con protecci√≥n contra bajadas fuertes.
                    </small>
                </div>
                
                <p class="small text-muted mb-0"><strong>Diferencia clave con RSI:</strong> EMA sin switches = B&H con veto | RSI sin switches = Fuerza Pura agresiva (>55)</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-6 border-end">
        <h4 class="mb-3 text-primary">Configuraci√≥n de Cruce de EMA</h4>
        
        <div class="row row-control align-items-center mb-4">
            <div class="col-7"><label for="ema_cruce_signal" class="form-check-label fw-bold">Activar Cruce (Fast > Slow):</label></div>
            <div class="col-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="ema_cruce_signal" name="ema_cruce_signal" value="True" 
                           {% if config.ema_cruce_signal == 'True' %}checked{% endif %}>
                </div>
            </div>
        </div>

        <div class="row row-control align-items-center mb-3">
            <div class="col-7"><label for="ema_fast_period" class="form-label">Per√≠odo de EMA R√°pida:</label></div>
            <div class="col-3">
                <input type="number" class="form-control" id="ema_fast_period" name="ema_fast_period" min="2" value="{{ config.ema_fast_period }}">
            </div>
        </div>

        <div class="row row-control align-items-center mb-4">
            <div class="col-7"><label for="ema_slow_period" class="form-label">Per√≠odo de EMA Lenta:</label></div>
            <div class="col-3">
                <input type="number" class="form-control" id="ema_slow_period" name="ema_slow_period" min="2" value="{{ config.ema_slow_period }}">
            </div>
        </div>
    </div>

    <div class="col-6">
        <h4 class="mb-3 text-dark">Filtros de Estado</h4>
        <p class="text-muted small">Activa los tipos de se√±al que deseas usar. Ver recuadro anterior para detalles.</p>

        <h5 class="mt-4 text-success">üü¢ Signals de Compra (OR)</h5>
        <div class="row mb-2">
            <div class="col-12 mb-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="ema_slow_minimo" name="ema_slow_minimo" value="True"
                           {% if config.ema_slow_minimo == 'True' %}checked{% endif %}>
                    <label class="form-check-label fw-bold" for="ema_slow_minimo">M√≠nimo Local</label>
                </div>
            </div>
            <div class="col-12">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="ema_slow_ascendente" name="ema_slow_ascendente" value="True"
                           {% if config.ema_slow_ascendente == 'True' %}checked{% endif %}>
                    <label class="form-check-label fw-bold" for="ema_slow_ascendente">Tendencia Alcista</label>
                </div>
            </div>
        </div>

        <h5 class="mt-4 text-danger">üî¥ Se√±ales de Venta (OR) / Bloqueos (AND)</h5>
        <div class="row">
            <div class="col-12 mb-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="ema_slow_maximo" name="ema_slow_maximo" value="True"
                           {% if config.ema_slow_maximo == 'True' %}checked{% endif %}>
                    <label class="form-check-label fw-bold" for="ema_slow_maximo">M√°ximo Local (Venta + Bloqueo)</label>
                </div>
            </div>
            <div class="col-12">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="ema_slow_descendente" name="ema_slow_descendente" value="True"
                           {% if config.ema_slow_descendente == 'True' %}checked{% endif %}>
                    <label class="form-check-label fw-bold" for="ema_slow_descendente">Tendencia Bajista (Venta + Veto)</label>
                </div>
            </div>
        </div>
    </div>
</div>