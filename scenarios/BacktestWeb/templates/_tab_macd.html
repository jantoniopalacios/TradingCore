<h2 class="mb-3">
    Par√°metros de MACD (Moving Average Convergence Divergence)
    <button type="button" class="btn btn-sm btn-info ms-2" data-bs-toggle="modal" data-bs-target="#macHelpModal">
        ‚ÑπÔ∏è Ayuda
    </button>
</h2>
<p class="alert alert-info">Configura los per√≠odos de c√°lculo del MACD y define las condiciones de se√±al (cruce o histograma) con l√≥gica de exclusividad.</p>

<!-- Modal de Ayuda MACD -->
<div class="modal fade" id="macHelpModal" tabindex="-1" aria-labelledby="macHelpModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="macHelpModalLabel">üìä Ayuda: Indicador MACD</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6 class="mb-3 text-primary">üîç ¬øQu√© es el MACD?</h6>
                <p>
                    El <strong>MACD (Moving Average Convergence Divergence)</strong> es un indicador de momentum que mide la relaci√≥n
                    entre dos medias m√≥viles exponenciales (EMA). Detecta cambios de direcci√≥n y fuerza del impulso.
                </p>
                
                <h6 class="mt-4 mb-2 text-primary">üìà Componentes del MACD:</h6>
                <ul class="small">
                    <li><strong>MACD Line:</strong> EMA r√°pida (12) - EMA lenta (26)</li>
                    <li><strong>Signal Line:</strong> EMA de 9 per√≠odos de la MACD Line</li>
                    <li><strong>Histograma:</strong> Diferencia entre MACD Line y Signal Line</li>
                </ul>
                
                <h6 class="mt-4 mb-2 text-primary">‚öôÔ∏è Par√°metros Configurables:</h6>
                <table class="table table-sm table-bordered">
                    <tr>
                        <th>Par√°metro</th>
                        <th>Default</th>
                        <th>Rango Recomendado</th>
                        <th>Descripci√≥n</th>
                    </tr>
                    <tr>
                        <td>Fast Period</td>
                        <td>12</td>
                        <td>8-15</td>
                        <td>EMA r√°pida. Menor = m√°s reactivo</td>
                    </tr>
                    <tr>
                        <td>Slow Period</td>
                        <td>26</td>
                        <td>20-35</td>
                        <td>EMA lenta. Mayor = m√°s suave</td>
                    </tr>
                    <tr>
                        <td>Signal Period</td>
                        <td>9</td>
                        <td>7-12</td>
                        <td>L√≠nea de se√±al. Afecta sensibilidad de cruces</td>
                    </tr>
                </table>
                
                <h6 class="mt-4 mb-2 text-success">üü¢ Se√±ales de COMPRA:</h6>
                <ul class="small">
                    <li><strong>MACD Fuerte (Default):</strong> MACD Line cruza por encima de Signal Line</li>
                    <li>
                        <strong>Con Ascendente:</strong> Adem√°s, el histograma debe estar SUBIENDO 
                        (impulso creciente = mayor confianza)
                    </li>
                </ul>
                
                <h6 class="mt-4 mb-2 text-danger">üî¥ Se√±ales de VENTA / BLOQUEOS:</h6>
                <ul class="small">
                    <li>
                        <strong>M√°ximo:</strong> Vende cuando el histograma alcanza un punto m√°ximo 
                        (sobrecompra). Tambi√©n BLOQUEA nuevas compras mientras est√© en m√°ximo.
                    </li>
                    <li>
                        <strong>Descendente:</strong> Vende cuando el histograma BAJA 
                        (p√©rdida de impulso). Tambi√©n BLOQUEA nuevas compras.
                    </li>
                </ul>
                
                <div class="alert alert-warning mt-4">
                    <h6 class="mb-2">‚ö†Ô∏è <strong>IMPORTANTE: Sin Switches Activados</strong></h6>
                    <p class="mb-0">
                        Si NO activas ning√∫n switch (M√≠nimo, M√°ximo, Ascendente, Descendente), 
                        el MACD generaply compras por <strong>MACD Fuerte</strong> (cruce simple) 
                        y <strong>SOLO</strong> ventas por <strong>StopLoss</strong>. 
                        Es un modo autom√°tico que puede generar MUCHAS se√±ales.
                    </p>
                </div>
                
                <h6 class="mt-4 mb-2 text-info">üîÄ Diferencia vs Otros Indicadores:</h6>
                <ul class="small">
                    <li><strong>vs EMA:</strong> MACD es momentum puro, no bloquea por descenso de EMA</li>
                    <li><strong>vs RSI:</strong> MACD usa cruces de medias, RSI usa sobreventa/sobrecompra</li>
                    <li><strong>Sin vetos hardcoded:</strong> A diferencia de EMA, MACD NO tiene bloqueos permanentes</li>
                </ul>
                
                <h6 class="mt-4 mb-2 text-success">‚úÖ Ejemplo de Configuraci√≥n Equilibrada:</h6>
                <code class="small">
                    Fast=12, Slow=26, Signal=9 (est√°ndar) + M√°ximo + Descendente
                    = Venta en picos Y cuando pierde impulso
                </code>
                
                <h6 class="mt-4 mb-2 text-info">‚ö° Ejemplo de Configuraci√≥n Agresiva:</h6>
                <code class="small">
                    Fast=8, Slow=17, Signal=9 + Sin switches + Ascendente
                    = Muchas compras, cierre solo por StopLoss
                </code>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-6 border-end">
        <h4 class="mb-3 text-primary">Configuraci√≥n Principal y Per√≠odos</h4>

        <div class="row row-control align-items-center mb-4">
            <div class="col-7"><label for="macd" class="form-check-label fw-bold">Activar MACD como Se√±al:</label></div>
            <div class="col-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" 
                            id="macd" 
                            name="macd" 
                            value="True" 
                            {% if config.macd == 'True' %}checked{% endif %}>
                </div>
            </div>
            <div class="col-2"><span class="text-muted small">{% if comments.macd %}<a href="#" title="{{ comments.macd }}">?</a>{% endif %}</span></div>
        </div>

        <div class="row row-control align-items-center mb-3">
            <div class="col-7"><label for="macd_fast" class="form-label">Per√≠odo R√°pido (Fast Period):</label></div>
            <div class="col-3">
                <input type="number" class="form-control" id="macd_fast" name="macd_fast" min="2" value="{{ config.macd_fast }}">
            </div>
            <div class="col-2"><span class="text-muted small">{% if comments.macd_fast %}<a href="#" title="{{ comments.macd_fast }}">?</a>{% endif %}</span></div>
        </div>

        <div class="row row-control align-items-center mb-3">
            <div class="col-7"><label for="macd_slow" class="form-label">Per√≠odo Lento (Slow Period):</label></div>
            <div class="col-3">
                <input type="number" class="form-control" id="macd_slow" name="macd_slow" min="2" value="{{ config.macd_slow }}">
            </div>
            <div class="col-2"><span class="text-muted small">{% if comments.macd_slow %}<a href="#" title="{{ comments.macd_slow }}">?</a>{% endif %}</span></div>
        </div>
        
        <div class="row row-control align-items-center mb-4">
            <div class="col-7"><label for="macd_signal" class="form-label">Per√≠odo de Se√±al (Signal Period):</label></div>
            <div class="col-3">
                <input type="number" class="form-control" id="macd_signal" name="macd_signal" min="1" value="{{ config.macd_signal }}">
            </div>
            <div class="col-2"><span class="text-muted small">{% if comments.macd_signal %}<a href="#" title="{{ comments.macd_signal }}">?</a>{% endif %}</span></div>
        </div>
    </div>

    <div class="col-6">
        <h4 class="mb-3 text-dark">L√≥gica de Se√±al (Exclusividad)</h4>
        <p class="text-muted small">Define si la se√±al de compra/venta se basa en el **Cruce** (MACD vs. Signal) o en el **Histograma** (cambio de signo).</p>

        <h5 class="mt-4 text-success">L√≥gica de Compra (Buy Logic)</h5>
        <div class="row row-control align-items-center mb-4">
            <div class="col-4"><label class="form-label fw-bold">Se√±al de Compra:</label></div>
            <div class="col-8">
                <div class="btn-group" role="group">
                    
                    <input type="radio" class="btn-check" name="macd_buy_logic" id="macd_cruce_up" value="macd_cruce_up" 
                            {% if config.macd_buy_logic == 'macd_cruce_up' %}checked{% endif %}>
                    <label class="btn btn-outline-success" for="macd_cruce_up" title="MACD cruza la l√≠nea Signal al alza">Cruce Up</label>
                    
                    <input type="radio" class="btn-check" name="macd_buy_logic" id="macd_histogram_buy" value="macd_histogram_buy" 
                            {% if config.macd_buy_logic == 'macd_histogram_buy' %}checked{% endif %}>
                    <label class="btn btn-outline-success" for="macd_histogram_buy" title="El histograma cruza de negativo a positivo">Histograma Buy</label>

                    <input type="radio" class="btn-check" name="macd_buy_logic" id="macd_buy_none" value="None" 
                            {% if config.macd_buy_logic == 'None' %}checked{% endif %}>
                    <label class="btn btn-outline-secondary" for="macd_buy_none">Ninguna</label>
                </div>
            </div>
        </div>

        <h5 class="mt-4 text-danger">L√≥gica de Venta (Sell Logic)</h5>
        <div class="row row-control align-items-center mb-4">
            <div class="col-4"><label class="form-label fw-bold">Se√±al de Venta:</label></div>
            <div class="col-8">
                <div class="btn-group" role="group">
                    
                    <input type="radio" class="btn-check" name="macd_sell_logic" id="macd_cruce_down" value="macd_cruce_down" 
                            {% if config.macd_sell_logic == 'macd_cruce_down' %}checked{% endif %}>
                    <label class="btn btn-outline-danger" for="macd_cruce_down" title="MACD cruza la l√≠nea Signal a la baja">Cruce Down</label>
                    
                    <input type="radio" class="btn-check" name="macd_sell_logic" id="macd_histogram_sell" value="macd_histogram_sell" 
                            {% if config.macd_sell_logic == 'macd_histogram_sell' %}checked{% endif %}>
                    <label class="btn btn-outline-danger" for="macd_histogram_sell" title="El histograma cruza de positivo a negativo">Histograma Sell</label>

                    <input type="radio" class="btn-check" name="macd_sell_logic" id="macd_sell_none" value="None" 
                            {% if config.macd_sell_logic == 'None' %}checked{% endif %}>
                    <label class="btn btn-outline-secondary" for="macd_sell_none">Ninguna</label>
                </div>
            </div>
        </div>
    </div>
</div>